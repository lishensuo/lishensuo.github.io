<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">

<link rel="icon" href="/favicon.ico" type="image/x-icon"> 
<title>æ·±åº¦å­¦ä¹ --GANåŸºç¡€ | Li&#39;s Bioinfo-Blog</title>
<meta name="keywords" content="æ·±åº¦å­¦ä¹ ">
<meta name="description" content="

2014å¹´è®ºæ–‡ï¼šhttps://proceedings.neurips.cc/paper_files/paper/2014/file/5ca3e9b122f61f8f06494c97b1afccf3-Paper.pdf
Pytorch DCGANå®ç°ï¼šhttps://pytorch.org/tutorials/beginner/dcgan_faces_tutorial.html
Other (e.g. cGAN)ï¼šhttps://github.com/gordicaleksa/pytorch-GANs

1. ç®€ä»‹
GAN (Generative Adversarial Networks, ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ) äº2014å¹´ç”±Ianç­‰æå‡ºã€‚ç®€å•æ¥è¯´ï¼ŒGANä¸»è¦åŒ…å«ä¸¤ä¸ªæ¨¡å‹ï¼š">
<meta name="author" content="Lishensuo">
<link rel="canonical" href="https://lishensuo.github.io/en/posts/bioinfo/716%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0--gan%E5%9F%BA%E7%A1%80/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.9e4de5e3ba61ea358168341aa7cdf70abfaafb7c697dfe8624af3ddff9a35c2f.css" integrity="sha256-nk3l47ph6jWBaDQap833Cr&#43;q&#43;3xpff6GJK893/mjXC8=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.555af97124d54bb1457985dd081b8f5616a48103aafeb30ac89fde835d65aa6c.js" integrity="sha256-VVr5cSTVS7FFeYXdCBuPVhakgQOq/rMKyJ/eg11lqmw="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://lishensuo.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://lishensuo.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://lishensuo.github.io/img/Q.gif">
<link rel="apple-touch-icon" href="https://lishensuo.github.io/Q.gif">
<link rel="mask-icon" href="https://lishensuo.github.io/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://lishensuo.github.io/en/posts/bioinfo/716%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0--gan%E5%9F%BA%E7%A1%80/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="æ·±åº¦å­¦ä¹ --GANåŸºç¡€" />
<meta property="og:description" content="

2014å¹´è®ºæ–‡ï¼šhttps://proceedings.neurips.cc/paper_files/paper/2014/file/5ca3e9b122f61f8f06494c97b1afccf3-Paper.pdf
Pytorch DCGANå®ç°ï¼šhttps://pytorch.org/tutorials/beginner/dcgan_faces_tutorial.html
Other (e.g. cGAN)ï¼šhttps://github.com/gordicaleksa/pytorch-GANs

1. ç®€ä»‹
GAN (Generative Adversarial Networks, ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ) äº2014å¹´ç”±Ianç­‰æå‡ºã€‚ç®€å•æ¥è¯´ï¼ŒGANä¸»è¦åŒ…å«ä¸¤ä¸ªæ¨¡å‹ï¼š" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lishensuo.github.io/en/posts/bioinfo/716%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0--gan%E5%9F%BA%E7%A1%80/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-09-03T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2024-09-03T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="æ·±åº¦å­¦ä¹ --GANåŸºç¡€"/>
<meta name="twitter:description" content="

2014å¹´è®ºæ–‡ï¼šhttps://proceedings.neurips.cc/paper_files/paper/2014/file/5ca3e9b122f61f8f06494c97b1afccf3-Paper.pdf
Pytorch DCGANå®ç°ï¼šhttps://pytorch.org/tutorials/beginner/dcgan_faces_tutorial.html
Other (e.g. cGAN)ï¼šhttps://github.com/gordicaleksa/pytorch-GANs

1. ç®€ä»‹
GAN (Generative Adversarial Networks, ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ) äº2014å¹´ç”±Ianç­‰æå‡ºã€‚ç®€å•æ¥è¯´ï¼ŒGANä¸»è¦åŒ…å«ä¸¤ä¸ªæ¨¡å‹ï¼š"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "åˆ†ç±»",
      "item": "https://lishensuo.github.io/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ“– ç”Ÿä¿¡æ•°æ®åˆ†æ--åˆ†ææµç¨‹ï¼Œå·¥å…·åŒ…ç­‰",
      "item": "https://lishensuo.github.io/en/posts/bioinfo/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "æ·±åº¦å­¦ä¹ --GANåŸºç¡€",
      "item": "https://lishensuo.github.io/en/posts/bioinfo/716%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0--gan%E5%9F%BA%E7%A1%80/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "æ·±åº¦å­¦ä¹ --GANåŸºç¡€",
  "name": "æ·±åº¦å­¦ä¹ --GANåŸºç¡€",
  "description": " 2014å¹´è®ºæ–‡ï¼šhttps://proceedings.neurips.cc/paper_files/paper/2014/file/5ca3e9b122f61f8f06494c97b1afccf3-Paper.pdf Pytorch DCGANå®ç°ï¼šhttps://pytorch.org/tutorials/beginner/dcgan_faces_tutorial.html Other (e.g. cGAN)ï¼šhttps://github.com/gordicaleksa/pytorch-GANs 1. ç®€ä»‹ GAN (Generative Adversarial Networks, ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ) äº2014å¹´ç”±Ianç­‰æå‡ºã€‚ç®€å•æ¥è¯´ï¼ŒGANä¸»è¦åŒ…å«ä¸¤ä¸ªæ¨¡å‹ï¼š\n",
  "keywords": [
    "æ·±åº¦å­¦ä¹ "
  ],
  "articleBody": " 2014å¹´è®ºæ–‡ï¼šhttps://proceedings.neurips.cc/paper_files/paper/2014/file/5ca3e9b122f61f8f06494c97b1afccf3-Paper.pdf Pytorch DCGANå®ç°ï¼šhttps://pytorch.org/tutorials/beginner/dcgan_faces_tutorial.html Other (e.g. cGAN)ï¼šhttps://github.com/gordicaleksa/pytorch-GANs 1. ç®€ä»‹ GAN (Generative Adversarial Networks, ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ) äº2014å¹´ç”±Ianç­‰æå‡ºã€‚ç®€å•æ¥è¯´ï¼ŒGANä¸»è¦åŒ…å«ä¸¤ä¸ªæ¨¡å‹ï¼š\nGenerator, Gï¼šæ ¹æ®æ¥è‡ªäºéšæœºåˆ†å¸ƒç©ºé—´çš„åˆå§‹å˜é‡zï¼Œç»ç”Ÿæˆå™¨æ¨¡å‹è¾“å‡ºï¼Œå¾—åˆ°ç›®æ ‡å½¢å¼çš„åˆ†å¸ƒç©ºé—´ï¼ˆä¾‹å¦‚å›¾ç‰‡ç­‰ï¼‰ æ¯”å–»ï¼šç½ªçŠ¯åŸºäºä¸€äº›åŸææ–™ï¼Œè®¾è®¡å·¥è‰ºæµç¨‹æ‰€ç”Ÿæˆçš„å‡å¸ Discriminatorï¼ŒDï¼šåŒºåˆ†æ¥è‡ªäºçœŸå®æ ·æœ¬xçš„åˆ†å¸ƒï¼ˆæ ‡ç­¾ä¸º1ï¼‰ï¼Œè¿˜æ˜¯æ¥è‡ªç”Ÿæˆå™¨è¾“å‡º**G(z)**çš„æ¨¡æ‹Ÿåˆ†å¸ƒï¼ˆæ ‡ç­¾ä¸º0ï¼‰ æ¯”å–»ï¼šè­¦å¯Ÿæ ¹æ®ä¸€äº›æŠ€æœ¯æ‰‹æ®µï¼Œè¾¨åˆ«æ˜¯é“¶è¡Œçš„çœŸå¸ï¼Œè¿˜æ˜¯ç½ªçŠ¯ç”Ÿäº§çš„å‡å¸ã€‚ åœ¨æ¯ä¸€æ¬¡(batch)çš„è®­ç»ƒè¿‡ç¨‹ä¸­ï¼š\né¦–å…ˆï¼Œæ›´æ–°Discriminatoræ¨¡å‹å‚æ•°ï¼Œä»è€ŒåŒºåˆ†ç›®å‰ç»™å®šçš„realä¸fakeæ•°æ®åˆ†å¸ƒ æœ€å¤§åŒ–ç›®æ ‡å‡½æ•°åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šå·¦ä¾§å¢å¤§ï¼Œå¯ä»¥å°†çœŸå®æ ·æœ¬é¢„æµ‹ä¸º1ï¼›å³ä¾§å¢å¤§ï¼Œå¯ä»¥å³å°†æ¨¡æ‹Ÿæ ·æœ¬é¢„æµ‹ä¸º0 ç„¶åï¼Œæ›´æ–°Generatorï¼Œä½¿å¾—æ¨¡æ‹Ÿçš„æ ·æœ¬åˆ†å¸ƒå°½å¯èƒ½è¢«Discriminatorè¯¯è®¤ä¸ºæ˜¯çœŸå®çš„ã€‚ æœ€å°åŒ–ç›®æ ‡å‡½æ•°ï¼šå³è®©D(G(z))çš„è¾“å‡ºä¸º1 åœ¨å¤šè½®è¿­ä»£è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒDiscriminatorä¸Generatorä¿æŒå¯¹æŠ—å­¦ä¹ ï¼Œé¢„æœŸç›®æ ‡æ˜¯Generatorçš„è¾“å‡ºè¶³å¤Ÿæ¥è¿‘ï¼Œä½¿å¾—Discriminatorå¯¹äºäºŒè€…æ ·æœ¬ç±»å‹çš„é¢„æµ‹å‡ä¸º1/2. GANæœ¬è´¨ä¸Šå±äºæ˜¯æ— ç›‘ç£å­¦ä¹ ã€‚å®ƒä¸æ˜¯ä¸ºå­¦ä¹ åˆ°ä¸ç›®æ ‡å›¾ç‰‡ä¸€æ¨¡ä¸€æ ·çš„ç»“æœï¼Œè€Œæ˜¯å­¦ä¹ ç›®æ ‡å›¾ç‰‡çš„æ•°æ®åˆ†å¸ƒï¼Œä»è€Œè¾¾åˆ°çœŸå®çš„æ•ˆæœã€‚\n2. ä»£ç å®ç° æ¥ä¸‹æ¥å°†åŸºäºDCGANæ¶æ„ï¼Œå­¦ä¹ GANçš„ä»£ç å®ç°æ–¹å¼ã€‚å…¶ä¸»è¦åŸºäºäººè„¸å›¾åƒæ•°æ®é›†ï¼Œç”Ÿæˆè™šæ‹Ÿçš„äººè„¸å›¾åƒ è®­ç»ƒæ•°æ®é›†å¯ä»googleäº‘ç«¯ç¡¬ç›˜é‡Œä¸‹è½½(img_align_celeba.zip)ï¼Œè§£å‹åˆ°å·¥ä½œç›®å½•çš„data/celebaè·¯å¾„ä¸­ï¼ˆe.g. data/celeba/img_align_celeba/000001.jpgï¼‰ã€‚ 2.1 åŠ è½½åº“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #%matplotlib inline import argparse import os import random import torch import torch.nn as nn import torch.nn.parallel import torch.optim as optim import torch.utils.data import torchvision.datasets as dset import torchvision.transforms as transforms import torchvision.utils as vutils import numpy as np import matplotlib.pyplot as plt import matplotlib.animation as animation from IPython.display import HTML # Set random seed for reproducibility manualSeed = 999 #manualSeed = random.randint(1, 10000) # use if you want new results print(\"Random Seed: \", manualSeed) random.seed(manualSeed) torch.manual_seed(manualSeed) torch.use_deterministic_algorithms(True) # Needed for reproducible results 2.2 åˆå§‹å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # Root directory for dataset dataroot = \"data/celeba\" # Number of workers for dataloader workers = 2 # Batch size during training batch_size = 128 # Spatial size of training images. All images will be resized to this size using a transformer. # çœŸå®å›¾ç‰‡çš„é•¿/å®½ image_size = 64 # Number of channels in the training images. For color images this is 3 # çœŸå®å›¾ç‰‡çš„é€šé“æ•° nc = 3 # Size of z latent vector (i.e. size of generator input) # è¾“å…¥åˆ°ç”Ÿæˆå™¨Generatorçš„æ•°æ®å¤§å° nz = 100 # Size of feature maps in generator/ç”Ÿæˆå™¨é€šé“æ•°å˜åŒ–çš„å€æ•° ngf = 64 # Size of feature maps in discriminator/è¾¨åˆ«å™¨é€šé“æ•°å˜åŒ–çš„å€æ•° ndf = 64 # Number of training epochs num_epochs = 5 # Learning rate for optimizers lr = 0.0002 # Beta1 hyperparameter for Adam optimizers beta1 = 0.5 # Number of GPUs available. Use 0 for CPU mode. ngpu = 1 2.3 åŠ è½½æ•°æ®é›† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # We can use an image folder dataset the way we have it setup. # Create the dataset dataset = dset.ImageFolder(root=dataroot, transform=transforms.Compose([ transforms.Resize(image_size), transforms.CenterCrop(image_size), transforms.ToTensor(), transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5)), ])) # Create the dataloader dataloader = torch.utils.data.DataLoader(dataset, batch_size=batch_size, shuffle=True, num_workers=workers) a, _ = next(iter(dataloader)) a.shape # torch.Size([128, 3, 64, 64]) # Decide which device we want to run on device = torch.device(\"cuda:0\" if (torch.cuda.is_available() and ngpu \u003e 0) else \"cpu\") # Plot some training images real_batch = next(iter(dataloader)) plt.figure(figsize=(8,8)) plt.axis(\"off\") plt.title(\"Training Images\") plt.imshow(np.transpose(vutils.make_grid(real_batch[0].to(device)[:64], padding=2, normalize=True).cpu(),(1,2,0))) plt.show() 2.4 å®šä¹‰ç”Ÿæˆå™¨ ç”Ÿæˆå™¨Gï¼šä¸»è¦ä½¿ç”¨åå·ç§¯å±‚ï¼Œå°†å‘é‡æ•°æ®æ˜ å°„ä¸ºå›¾ç‰‡ å‚è€ƒä¸Šè¿°å›¾ç‰‡ï¼ŒåŸè®ºæ–‡çš„ngfåº”è¯¥æ˜¯128ã€‚è¿™é‡Œçš„ä»£ç è®¾ç½®ä¸ºäº†64ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 class Generator(nn.Module): def __init__(self, ngpu): super(Generator, self).__init__() self.ngpu = ngpu self.main = nn.Sequential( # input is Z, going into a convolution nn.ConvTranspose2d( nz, ngf * 8, 4, 1, 0, bias=False), nn.BatchNorm2d(ngf * 8), nn.ReLU(True), # state size. ``(ngf*8) x 4 x 4`` nn.ConvTranspose2d(ngf * 8, ngf * 4, 4, 2, 1, bias=False), nn.BatchNorm2d(ngf * 4), nn.ReLU(True), # state size. ``(ngf*4) x 8 x 8`` nn.ConvTranspose2d( ngf * 4, ngf * 2, 4, 2, 1, bias=False), nn.BatchNorm2d(ngf * 2), nn.ReLU(True), # state size. ``(ngf*2) x 16 x 16`` nn.ConvTranspose2d( ngf * 2, ngf, 4, 2, 1, bias=False), nn.BatchNorm2d(ngf), nn.ReLU(True), # state size. ``(ngf) x 32 x 32`` nn.ConvTranspose2d( ngf, nc, 4, 2, 1, bias=False), nn.Tanh() # state size. ``(nc) x 64 x 64`` ) def forward(self, input): return self.main(input) å®šä¹‰ç½‘ç»œå±‚å‚æ•°çš„åˆå§‹åŒ–æ–¹å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # custom weights initialization called on ``netG`` and ``netD`` def weights_init(m): classname = m.__class__.__name__ if classname.find('Conv') != -1: nn.init.normal_(m.weight.data, 0.0, 0.02) elif classname.find('BatchNorm') != -1: nn.init.normal_(m.weight.data, 1.0, 0.02) nn.init.constant_(m.bias.data, 0) # Create the generator netG = Generator(ngpu).to(device) # Handle multi-GPU if desired if (device.type == 'cuda') and (ngpu \u003e 1): netG = nn.DataParallel(netG, list(range(ngpu))) # Apply the ``weights_init`` function to randomly initialize all weights # to ``mean=0``, ``stdev=0.02``. netG.apply(weights_init) # Print the model print(netG) 2.5 å®šä¹‰è¾¨åˆ«å™¨ è¾¨åˆ«å™¨Dï¼šä¸»è¦ä½¿ç”¨å·ç§¯å±‚ï¼Œè¾“å‡ºä¸ºä¸€ä¸ªæ ‡é‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 class Discriminator(nn.Module): def __init__(self, ngpu): super(Discriminator, self).__init__() self.ngpu = ngpu self.main = nn.Sequential( # input is ``(nc) x 64 x 64`` nn.Conv2d(nc, ndf, 4, 2, 1, bias=False), nn.LeakyReLU(0.2, inplace=True), # state size. ``(ndf) x 32 x 32`` nn.Conv2d(ndf, ndf * 2, 4, 2, 1, bias=False), nn.BatchNorm2d(ndf * 2), nn.LeakyReLU(0.2, inplace=True), # state size. ``(ndf*2) x 16 x 16`` nn.Conv2d(ndf * 2, ndf * 4, 4, 2, 1, bias=False), nn.BatchNorm2d(ndf * 4), nn.LeakyReLU(0.2, inplace=True), # state size. ``(ndf*4) x 8 x 8`` nn.Conv2d(ndf * 4, ndf * 8, 4, 2, 1, bias=False), nn.BatchNorm2d(ndf * 8), nn.LeakyReLU(0.2, inplace=True), # state size. ``(ndf*8) x 4 x 4`` nn.Conv2d(ndf * 8, 1, 4, 1, 0, bias=False), nn.Sigmoid() ) def forward(self, input): return self.main(input) æ¨¡å‹åˆå§‹åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 # Create the Discriminator netD = Discriminator(ngpu).to(device) # Handle multi-GPU if desired if (device.type == 'cuda') and (ngpu \u003e 1): netD = nn.DataParallel(netD, list(range(ngpu))) # Apply the ``weights_init`` function to randomly initialize all weights # like this: ``to mean=0, stdev=0.2``. netD.apply(weights_init) # Print the model print(netD) 2.6 è®­ç»ƒæ¨¡å‹ å®šä¹‰æŸå¤±å‡½æ•°ã€ä¼˜åŒ–å™¨ç­‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 # Initialize the ``BCELoss`` function äºŒåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•° criterion = nn.BCELoss() # Create batch of latent vectors that we will use to visualize the progression of the generator fixed_noise = torch.randn(64, nz, 1, 1, device=device) # Establish convention for real and fake labels during training real_label = 1. fake_label = 0. # Setup Adam optimizers for both G and D ä¼˜åŒ–ç®—æ³• optimizerD = optim.Adam(netD.parameters(), lr=lr, betas=(beta1, 0.999)) optimizerG = optim.Adam(netG.parameters(), lr=lr, betas=(beta1, 0.999)) è®­ç»ƒä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 # Lists to keep track of progress img_list = [] G_losses = [] D_losses = [] iters = 0 print(\"Starting Training Loop...\") # For each epoch for epoch in range(num_epochs): # For each batch in the dataloader for i, data in enumerate(dataloader, 0): ############################ # (1) Update D network: maximize log(D(x)) + log(1 - D(G(z))) ########################### ## Train with all-real batchï¼Œé‡ç½®æ¨¡å‹Dçš„æ¢¯åº¦ netD.zero_grad() # Format batch real_cpu = data[0].to(device) b_size = real_cpu.size(0) label = torch.full((b_size,), real_label, dtype=torch.float, device=device) # Forward pass real batch through D, è½¬ä¸ºä¸€ç»´å‘é‡ output = netD(real_cpu).view(-1) # Calculate loss on all-real batch errD_real = criterion(output, label) # Calculate gradients for D in backward passï¼ŒåŸºäºçœŸå®æ ·æœ¬çš„æ¢¯åº¦æ›´æ–° errD_real.backward() D_x = output.mean().item() ## Train with all-fake batch # Generate batch of latent vectorsï¼ŒåŸºäºæ­£æ€åˆ†å¸ƒï¼Œéšæœºåˆå§‹åŒ–è¾“å…¥z noise = torch.randn(b_size, nz, 1, 1, device=device) # Generate fake image batch with G fake = netG(noise) label.fill_(fake_label) # Classify all fake batch with D output = netD(fake.detach()).view(-1) # Calculate D's loss on the all-fake batch errD_fake = criterion(output, label) # Calculate the gradients for this batch, accumulated (summed) with previous gradients # å†åŸºäºæ¨¡æ‹Ÿæ ·æœ¬çš„æ¢¯åº¦æ›´æ–°ï¼Œä¸¤æ¬¡æ¢¯åº¦çš„ç»“æœä¼šç´¯åŠ  errD_fake.backward() D_G_z1 = output.mean().item() # Compute error of D as sum over the fake and the real batches errD = errD_real + errD_fake # Update Dï¼ŒåŸºäºä¸Šé¢ä¸¤è½®çš„æ¢¯åº¦ï¼Œæ›´æ–°æ¨¡å‹å‚æ•° optimizerD.step() ############################ # (2) Update G network: maximize log(D(G(z))) ########################### netG.zero_grad() #é‡ç½®æ¨¡å‹Gçš„æ¢¯åº¦ label.fill_(real_label) # fake labels are real for generator cost # Since we just updated D, perform another forward pass of all-fake batch through D output = netD(fake).view(-1) # Calculate G's loss based on this output errG = criterion(output, label) # Calculate gradients for G errG.backward() D_G_z2 = output.mean().item() # Update G optimizerG.step() # Output training statsï¼Œæ¯50ä¸ªbatchæ‰“å°ä¸€æ¬¡ç»“æœ if i % 50 == 0: print('[%d/%d][%d/%d]\\tLoss_D: %.4f\\tLoss_G: %.4f\\tD(x): %.4f\\tD(G(z)): %.4f / %.4f' % (epoch, num_epochs, i, len(dataloader), errD.item(), errG.item(), D_x, D_G_z1, D_G_z2)) # Save Losses for plotting later G_losses.append(errG.item()) D_losses.append(errD.item()) # è®°å½•ä¸åŒè®­ç»ƒé˜¶æ®µçš„è®­ç»ƒç”Ÿæˆç»“æœ # Check how the generator is doing by saving G's output on fixed_noise if (iters % 500 == 0) or ((epoch == num_epochs-1) and (i == len(dataloader)-1)): with torch.no_grad(): fake = netG(fixed_noise).detach().cpu() img_list.append(vutils.make_grid(fake, padding=2, normalize=True)) iters += 1 æŸ¥çœ‹è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹Gä¸Dçš„æŸå¤±å‡½æ•° 1 2 3 4 5 6 7 8 plt.figure(figsize=(10,5)) plt.title(\"Generator and Discriminator Loss During Training\") plt.plot(G_losses,label=\"G\") plt.plot(D_losses,label=\"D\") plt.xlabel(\"iterations\") plt.ylabel(\"Loss\") plt.legend() plt.show() å¯¹æ¯”çœŸå®ä¸é¢„æµ‹å›¾ç‰‡æ ·æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Grab a batch of real images from the dataloader real_batch = next(iter(dataloader)) # Plot the real images plt.figure(figsize=(15,15)) plt.subplot(1,2,1) plt.axis(\"off\") plt.title(\"Real Images\") plt.imshow(np.transpose(vutils.make_grid(real_batch[0].to(device)[:64], padding=5, normalize=True).cpu(),(1,2,0))) # Plot the fake images from the last epoch plt.subplot(1,2,2) plt.axis(\"off\") plt.title(\"Fake Images\") plt.imshow(np.transpose(img_list[-1],(1,2,0))) plt.show() ",
  "wordCount" : "2788",
  "inLanguage": "en",
  "datePublished": "2024-09-03T00:00:00Z",
  "dateModified": "2024-09-03T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "Lishensuo"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://lishensuo.github.io/en/posts/bioinfo/716%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0--gan%E5%9F%BA%E7%A1%80/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Li's Bioinfo-Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://lishensuo.github.io/img/Q.gif"
    }
  }
}
</script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://lishensuo.github.io/en/" accesskey="h" title="Li&#39;s Bioinfo-Blog (Alt + H)">Li&#39;s Bioinfo-Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://lishensuo.github.io/en/" title="ä¸»é¡µ">
                    <span>ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://lishensuo.github.io/en/posts" title="åˆ†ç±»">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://lishensuo.github.io/en/tags" title="æ ‡ç­¾">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://lishensuo.github.io/en/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://lishensuo.github.io/en/about" title="å…³äº">
                    <span>å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://lishensuo.github.io/en/search" title="æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://lishensuo.github.io/en/">Home</a>&nbsp;Â»&nbsp;<a href="https://lishensuo.github.io/en/posts/">åˆ†ç±»</a>&nbsp;Â»&nbsp;<a href="https://lishensuo.github.io/en/posts/bioinfo/">ğŸ“– ç”Ÿä¿¡æ•°æ®åˆ†æ--åˆ†ææµç¨‹ï¼Œå·¥å…·åŒ…ç­‰</a></div>
    <h1 class="post-title">
      æ·±åº¦å­¦ä¹ --GANåŸºç¡€
    </h1>
    <div class="post-meta">













Create:&amp;nbsp;&lt;span title=&#39;2024-09-03 00:00:00 &#43;0000 UTC&#39;&gt;2024-09-03&lt;/span&gt;&amp;nbsp;|&amp;nbsp;Update:&amp;nbsp;2024-09-03&amp;nbsp;|&amp;nbsp;Words:&amp;nbsp;2788&amp;nbsp;|&amp;nbsp;6 min&amp;nbsp;|&amp;nbsp;Lishensuo

|  Viewers: <span id="busuanzi_value_page_pv"></span> 
	  
    </div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#1-%e7%ae%80%e4%bb%8b" aria-label="1. ç®€ä»‹">1. ç®€ä»‹</a></li>
                    <li>
                        <a href="#2-%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" aria-label="2. ä»£ç å®ç°">2. ä»£ç å®ç°</a><ul>
                            
                    <li>
                        <a href="#21-%e5%8a%a0%e8%bd%bd%e5%ba%93" aria-label="2.1 åŠ è½½åº“">2.1 åŠ è½½åº“</a></li>
                    <li>
                        <a href="#22-%e5%88%9d%e5%a7%8b%e5%8f%82%e6%95%b0" aria-label="2.2 åˆå§‹å‚æ•°">2.2 åˆå§‹å‚æ•°</a></li>
                    <li>
                        <a href="#23-%e5%8a%a0%e8%bd%bd%e6%95%b0%e6%8d%ae%e9%9b%86" aria-label="2.3 åŠ è½½æ•°æ®é›†">2.3 åŠ è½½æ•°æ®é›†</a></li>
                    <li>
                        <a href="#24-%e5%ae%9a%e4%b9%89%e7%94%9f%e6%88%90%e5%99%a8" aria-label="2.4 å®šä¹‰ç”Ÿæˆå™¨">2.4 å®šä¹‰ç”Ÿæˆå™¨</a></li>
                    <li>
                        <a href="#25-%e5%ae%9a%e4%b9%89%e8%be%a8%e5%88%ab%e5%99%a8" aria-label="2.5 å®šä¹‰è¾¨åˆ«å™¨">2.5 å®šä¹‰è¾¨åˆ«å™¨</a></li>
                    <li>
                        <a href="#26-%e8%ae%ad%e7%bb%83%e6%a8%a1%e5%9e%8b" aria-label="2.6 è®­ç»ƒæ¨¡å‹">2.6 è®­ç»ƒæ¨¡å‹</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>


  <div class="post-content"><blockquote>
<ul>
<li>2014å¹´è®ºæ–‡ï¼šhttps://proceedings.neurips.cc/paper_files/paper/2014/file/5ca3e9b122f61f8f06494c97b1afccf3-Paper.pdf</li>
<li>Pytorch DCGANå®ç°ï¼šhttps://pytorch.org/tutorials/beginner/dcgan_faces_tutorial.html</li>
<li>Other (e.g. cGAN)ï¼šhttps://github.com/gordicaleksa/pytorch-GANs</li>
</ul></blockquote>
<h1 id="1-ç®€ä»‹">1. ç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#1-ç®€ä»‹">#</a></h1>
<p>GAN (Generative Adversarial Networks, ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ) äº2014å¹´ç”±Ianç­‰æå‡ºã€‚ç®€å•æ¥è¯´ï¼ŒGANä¸»è¦åŒ…å«ä¸¤ä¸ªæ¨¡å‹ï¼š</p>
<ul>
<li>Generator, <strong>G</strong>ï¼šæ ¹æ®æ¥è‡ªäºéšæœºåˆ†å¸ƒç©ºé—´çš„åˆå§‹å˜é‡<strong>z</strong>ï¼Œç»ç”Ÿæˆå™¨æ¨¡å‹è¾“å‡ºï¼Œå¾—åˆ°ç›®æ ‡å½¢å¼çš„åˆ†å¸ƒç©ºé—´ï¼ˆä¾‹å¦‚å›¾ç‰‡ç­‰ï¼‰
<ul>
<li>æ¯”å–»ï¼šç½ªçŠ¯åŸºäºä¸€äº›åŸææ–™ï¼Œè®¾è®¡å·¥è‰ºæµç¨‹æ‰€ç”Ÿæˆçš„å‡å¸</li>
</ul>
</li>
<li>Discriminatorï¼Œ<strong>D</strong>ï¼šåŒºåˆ†æ¥è‡ªäºçœŸå®æ ·æœ¬<strong>x</strong>çš„åˆ†å¸ƒï¼ˆæ ‡ç­¾ä¸º1ï¼‰ï¼Œè¿˜æ˜¯æ¥è‡ªç”Ÿæˆå™¨è¾“å‡º**G(z)**çš„æ¨¡æ‹Ÿåˆ†å¸ƒï¼ˆæ ‡ç­¾ä¸º0ï¼‰
<ul>
<li>æ¯”å–»ï¼šè­¦å¯Ÿæ ¹æ®ä¸€äº›æŠ€æœ¯æ‰‹æ®µï¼Œè¾¨åˆ«æ˜¯é“¶è¡Œçš„çœŸå¸ï¼Œè¿˜æ˜¯ç½ªçŠ¯ç”Ÿäº§çš„å‡å¸ã€‚</li>
</ul>
</li>
</ul>
<img src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/image-20240828112704759.png" alt="image-20240828112704759" style="zoom:80%;" />
<p>åœ¨æ¯ä¸€æ¬¡(batch)çš„è®­ç»ƒè¿‡ç¨‹ä¸­ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œæ›´æ–°Discriminatoræ¨¡å‹å‚æ•°ï¼Œä»è€ŒåŒºåˆ†ç›®å‰ç»™å®šçš„realä¸fakeæ•°æ®åˆ†å¸ƒ
<ul>
<li><strong>æœ€å¤§åŒ–</strong>ç›®æ ‡å‡½æ•°åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šå·¦ä¾§å¢å¤§ï¼Œå¯ä»¥å°†çœŸå®æ ·æœ¬é¢„æµ‹ä¸º1ï¼›å³ä¾§å¢å¤§ï¼Œå¯ä»¥å³å°†æ¨¡æ‹Ÿæ ·æœ¬é¢„æµ‹ä¸º0</li>
</ul>
</li>
</ul>
<img src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/image-20240828120250425.png" alt="image-20240828120250425" style="zoom:80%;" />
<ul>
<li>ç„¶åï¼Œæ›´æ–°Generatorï¼Œä½¿å¾—æ¨¡æ‹Ÿçš„æ ·æœ¬åˆ†å¸ƒå°½å¯èƒ½è¢«Discriminatorè¯¯è®¤ä¸ºæ˜¯çœŸå®çš„ã€‚
<ul>
<li><strong>æœ€å°åŒ–</strong>ç›®æ ‡å‡½æ•°ï¼šå³è®©D(G(z))çš„è¾“å‡ºä¸º1</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/image-20240828121613943.png" alt="image-20240828121613943"  />
</p>
<ul>
<li>åœ¨å¤šè½®è¿­ä»£è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒDiscriminatorä¸Generatorä¿æŒå¯¹æŠ—å­¦ä¹ ï¼Œé¢„æœŸç›®æ ‡æ˜¯Generatorçš„è¾“å‡ºè¶³å¤Ÿæ¥è¿‘ï¼Œä½¿å¾—Discriminatorå¯¹äºäºŒè€…æ ·æœ¬ç±»å‹çš„é¢„æµ‹å‡ä¸º1/2.</li>
</ul>
<p><img loading="lazy" src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/image-20240828122558841.png" alt="image-20240828122558841"  />
</p>
<blockquote>
<p>GANæœ¬è´¨ä¸Šå±äºæ˜¯æ— ç›‘ç£å­¦ä¹ ã€‚å®ƒä¸æ˜¯ä¸ºå­¦ä¹ åˆ°ä¸ç›®æ ‡å›¾ç‰‡ä¸€æ¨¡ä¸€æ ·çš„ç»“æœï¼Œè€Œæ˜¯å­¦ä¹ ç›®æ ‡å›¾ç‰‡çš„æ•°æ®åˆ†å¸ƒï¼Œä»è€Œè¾¾åˆ°çœŸå®çš„æ•ˆæœã€‚</p></blockquote>
<h1 id="2-ä»£ç å®ç°">2. ä»£ç å®ç°<a hidden class="anchor" aria-hidden="true" href="#2-ä»£ç å®ç°">#</a></h1>
<ul>
<li>æ¥ä¸‹æ¥å°†åŸºäºDCGANæ¶æ„ï¼Œå­¦ä¹ GANçš„ä»£ç å®ç°æ–¹å¼ã€‚å…¶ä¸»è¦åŸºäºäººè„¸å›¾åƒæ•°æ®é›†ï¼Œç”Ÿæˆè™šæ‹Ÿçš„äººè„¸å›¾åƒ</li>
<li>è®­ç»ƒæ•°æ®é›†å¯ä»<a href="https://drive.google.com/drive/folders/0B7EVK8r0v71pTUZsaXdaSnZBZzg?resourcekey=0-rJlzl934LzC-Xp28GeIBzQ">googleäº‘ç«¯ç¡¬ç›˜</a>é‡Œä¸‹è½½(img_align_celeba.zip)ï¼Œè§£å‹åˆ°å·¥ä½œç›®å½•çš„<code>data/celeba</code>è·¯å¾„ä¸­ï¼ˆe.g. <code>data/celeba/img_align_celeba/000001.jpg</code>ï¼‰ã€‚</li>
</ul>
<h2 id="21-åŠ è½½åº“">2.1 åŠ è½½åº“<a hidden class="anchor" aria-hidden="true" href="#21-åŠ è½½åº“">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f">#%matplotlib inline</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> torch.nn <span style="color:#fff;font-weight:bold">as</span> nn
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> torch.nn.parallel
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> torch.optim <span style="color:#fff;font-weight:bold">as</span> optim
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> torch.utils.data
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> torchvision.datasets <span style="color:#fff;font-weight:bold">as</span> dset
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> torchvision.transforms <span style="color:#fff;font-weight:bold">as</span> transforms
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> torchvision.utils <span style="color:#fff;font-weight:bold">as</span> vutils
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> numpy <span style="color:#fff;font-weight:bold">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> matplotlib.pyplot <span style="color:#fff;font-weight:bold">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> matplotlib.animation <span style="color:#fff;font-weight:bold">as</span> animation
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> IPython.display <span style="color:#fff;font-weight:bold">import</span> HTML
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Set random seed for reproducibility</span>
</span></span><span style="display:flex;"><span>manualSeed = <span style="color:#ff0;font-weight:bold">999</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#manualSeed = random.randint(1, 10000) # use if you want new results</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#34;Random Seed: &#34;</span>, manualSeed)
</span></span><span style="display:flex;"><span>random.seed(manualSeed)
</span></span><span style="display:flex;"><span>torch.manual_seed(manualSeed)
</span></span><span style="display:flex;"><span>torch.use_deterministic_algorithms(<span style="color:#fff;font-weight:bold">True</span>) <span style="color:#007f7f"># Needed for reproducible results</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="22-åˆå§‹å‚æ•°">2.2 åˆå§‹å‚æ•°<a hidden class="anchor" aria-hidden="true" href="#22-åˆå§‹å‚æ•°">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f"># Root directory for dataset</span>
</span></span><span style="display:flex;"><span>dataroot = <span style="color:#0ff;font-weight:bold">&#34;data/celeba&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Number of workers for dataloader</span>
</span></span><span style="display:flex;"><span>workers = <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Batch size during training</span>
</span></span><span style="display:flex;"><span>batch_size = <span style="color:#ff0;font-weight:bold">128</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Spatial size of training images. All images will be resized to this size using a transformer.</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># çœŸå®å›¾ç‰‡çš„é•¿/å®½</span>
</span></span><span style="display:flex;"><span>image_size = <span style="color:#ff0;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Number of channels in the training images. For color images this is 3</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># çœŸå®å›¾ç‰‡çš„é€šé“æ•°</span>
</span></span><span style="display:flex;"><span>nc = <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Size of z latent vector (i.e. size of generator input)</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># è¾“å…¥åˆ°ç”Ÿæˆå™¨Generatorçš„æ•°æ®å¤§å°</span>
</span></span><span style="display:flex;"><span>nz = <span style="color:#ff0;font-weight:bold">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Size of feature maps in generator/ç”Ÿæˆå™¨é€šé“æ•°å˜åŒ–çš„å€æ•°</span>
</span></span><span style="display:flex;"><span>ngf = <span style="color:#ff0;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Size of feature maps in discriminator/è¾¨åˆ«å™¨é€šé“æ•°å˜åŒ–çš„å€æ•°</span>
</span></span><span style="display:flex;"><span>ndf = <span style="color:#ff0;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Number of training epochs</span>
</span></span><span style="display:flex;"><span>num_epochs = <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Learning rate for optimizers</span>
</span></span><span style="display:flex;"><span>lr = <span style="color:#ff0;font-weight:bold">0.0002</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Beta1 hyperparameter for Adam optimizers</span>
</span></span><span style="display:flex;"><span>beta1 = <span style="color:#ff0;font-weight:bold">0.5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Number of GPUs available. Use 0 for CPU mode.</span>
</span></span><span style="display:flex;"><span>ngpu = <span style="color:#ff0;font-weight:bold">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="23-åŠ è½½æ•°æ®é›†">2.3 åŠ è½½æ•°æ®é›†<a hidden class="anchor" aria-hidden="true" href="#23-åŠ è½½æ•°æ®é›†">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f"># We can use an image folder dataset the way we have it setup.</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Create the dataset</span>
</span></span><span style="display:flex;"><span>dataset = dset.ImageFolder(root=dataroot,
</span></span><span style="display:flex;"><span>                           transform=transforms.Compose([
</span></span><span style="display:flex;"><span>                               transforms.Resize(image_size),
</span></span><span style="display:flex;"><span>                               transforms.CenterCrop(image_size),
</span></span><span style="display:flex;"><span>                               transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                               transforms.Normalize((<span style="color:#ff0;font-weight:bold">0.5</span>, <span style="color:#ff0;font-weight:bold">0.5</span>, <span style="color:#ff0;font-weight:bold">0.5</span>), (<span style="color:#ff0;font-weight:bold">0.5</span>, <span style="color:#ff0;font-weight:bold">0.5</span>, <span style="color:#ff0;font-weight:bold">0.5</span>)),
</span></span><span style="display:flex;"><span>                           ]))
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Create the dataloader</span>
</span></span><span style="display:flex;"><span>dataloader = torch.utils.data.DataLoader(dataset, batch_size=batch_size,
</span></span><span style="display:flex;"><span>                                         shuffle=<span style="color:#fff;font-weight:bold">True</span>, num_workers=workers)
</span></span><span style="display:flex;"><span>a, _ = <span style="color:#fff;font-weight:bold">next</span>(<span style="color:#fff;font-weight:bold">iter</span>(dataloader))
</span></span><span style="display:flex;"><span>a.shape
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># torch.Size([128, 3, 64, 64])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Decide which device we want to run on</span>
</span></span><span style="display:flex;"><span>device = torch.device(<span style="color:#0ff;font-weight:bold">&#34;cuda:0&#34;</span> <span style="color:#fff;font-weight:bold">if</span> (torch.cuda.is_available() and ngpu &gt; <span style="color:#ff0;font-weight:bold">0</span>) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#0ff;font-weight:bold">&#34;cpu&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Plot some training images</span>
</span></span><span style="display:flex;"><span>real_batch = <span style="color:#fff;font-weight:bold">next</span>(<span style="color:#fff;font-weight:bold">iter</span>(dataloader))
</span></span><span style="display:flex;"><span>plt.figure(figsize=(<span style="color:#ff0;font-weight:bold">8</span>,<span style="color:#ff0;font-weight:bold">8</span>))
</span></span><span style="display:flex;"><span>plt.axis(<span style="color:#0ff;font-weight:bold">&#34;off&#34;</span>)
</span></span><span style="display:flex;"><span>plt.title(<span style="color:#0ff;font-weight:bold">&#34;Training Images&#34;</span>)
</span></span><span style="display:flex;"><span>plt.imshow(np.transpose(vutils.make_grid(real_batch[<span style="color:#ff0;font-weight:bold">0</span>].to(device)[:<span style="color:#ff0;font-weight:bold">64</span>], padding=<span style="color:#ff0;font-weight:bold">2</span>, normalize=<span style="color:#fff;font-weight:bold">True</span>).cpu(),(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">0</span>)))
</span></span><span style="display:flex;"><span>plt.show()
</span></span></code></pre></td></tr></table>
</div>
</div><img src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/sphx_glr_dcgan_faces_tutorial_001.png" alt="Training Images" style="zoom:50%;" />
<h2 id="24-å®šä¹‰ç”Ÿæˆå™¨">2.4 å®šä¹‰ç”Ÿæˆå™¨<a hidden class="anchor" aria-hidden="true" href="#24-å®šä¹‰ç”Ÿæˆå™¨">#</a></h2>
<ul>
<li>ç”Ÿæˆå™¨Gï¼šä¸»è¦ä½¿ç”¨åå·ç§¯å±‚ï¼Œå°†å‘é‡æ•°æ®æ˜ å°„ä¸ºå›¾ç‰‡</li>
</ul>
<img src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/dcgan_generator.png" alt="dcgan_generator" style="zoom: 50%;" />
<blockquote>
<p>å‚è€ƒä¸Šè¿°å›¾ç‰‡ï¼ŒåŸè®ºæ–‡çš„ngfåº”è¯¥æ˜¯128ã€‚è¿™é‡Œçš„ä»£ç è®¾ç½®ä¸ºäº†64ã€‚</p></blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Generator(nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __init__(<span style="color:#fff;font-weight:bold">self</span>, ngpu):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(Generator, <span style="color:#fff;font-weight:bold">self</span>).__init__()
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">self</span>.ngpu = ngpu
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">self</span>.main = nn.Sequential(
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># input is Z, going into a convolution</span>
</span></span><span style="display:flex;"><span>            nn.ConvTranspose2d( nz, ngf * <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">0</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.BatchNorm2d(ngf * <span style="color:#ff0;font-weight:bold">8</span>),
</span></span><span style="display:flex;"><span>            nn.ReLU(<span style="color:#fff;font-weight:bold">True</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># state size. ``(ngf*8) x 4 x 4``</span>
</span></span><span style="display:flex;"><span>            nn.ConvTranspose2d(ngf * <span style="color:#ff0;font-weight:bold">8</span>, ngf * <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.BatchNorm2d(ngf * <span style="color:#ff0;font-weight:bold">4</span>),
</span></span><span style="display:flex;"><span>            nn.ReLU(<span style="color:#fff;font-weight:bold">True</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># state size. ``(ngf*4) x 8 x 8``</span>
</span></span><span style="display:flex;"><span>            nn.ConvTranspose2d( ngf * <span style="color:#ff0;font-weight:bold">4</span>, ngf * <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.BatchNorm2d(ngf * <span style="color:#ff0;font-weight:bold">2</span>),
</span></span><span style="display:flex;"><span>            nn.ReLU(<span style="color:#fff;font-weight:bold">True</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># state size. ``(ngf*2) x 16 x 16``</span>
</span></span><span style="display:flex;"><span>            nn.ConvTranspose2d( ngf * <span style="color:#ff0;font-weight:bold">2</span>, ngf, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.BatchNorm2d(ngf),
</span></span><span style="display:flex;"><span>            nn.ReLU(<span style="color:#fff;font-weight:bold">True</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># state size. ``(ngf) x 32 x 32``</span>
</span></span><span style="display:flex;"><span>            nn.ConvTranspose2d( ngf, nc, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.Tanh()
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># state size. ``(nc) x 64 x 64``</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> forward(<span style="color:#fff;font-weight:bold">self</span>, <span style="color:#fff;font-weight:bold">input</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">self</span>.main(<span style="color:#fff;font-weight:bold">input</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å®šä¹‰ç½‘ç»œå±‚å‚æ•°çš„åˆå§‹åŒ–æ–¹å¼</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f"># custom weights initialization called on ``netG`` and ``netD``</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> weights_init(m):
</span></span><span style="display:flex;"><span>    classname = m.__class__.__name__
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> classname.find(<span style="color:#0ff;font-weight:bold">&#39;Conv&#39;</span>) != -<span style="color:#ff0;font-weight:bold">1</span>:
</span></span><span style="display:flex;"><span>        nn.init.normal_(m.weight.data, <span style="color:#ff0;font-weight:bold">0.0</span>, <span style="color:#ff0;font-weight:bold">0.02</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">elif</span> classname.find(<span style="color:#0ff;font-weight:bold">&#39;BatchNorm&#39;</span>) != -<span style="color:#ff0;font-weight:bold">1</span>:
</span></span><span style="display:flex;"><span>        nn.init.normal_(m.weight.data, <span style="color:#ff0;font-weight:bold">1.0</span>, <span style="color:#ff0;font-weight:bold">0.02</span>)
</span></span><span style="display:flex;"><span>        nn.init.constant_(m.bias.data, <span style="color:#ff0;font-weight:bold">0</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Create the generator</span>
</span></span><span style="display:flex;"><span>netG = Generator(ngpu).to(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Handle multi-GPU if desired</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (device.type == <span style="color:#0ff;font-weight:bold">&#39;cuda&#39;</span>) and (ngpu &gt; <span style="color:#ff0;font-weight:bold">1</span>):
</span></span><span style="display:flex;"><span>    netG = nn.DataParallel(netG, <span style="color:#fff;font-weight:bold">list</span>(<span style="color:#fff;font-weight:bold">range</span>(ngpu)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Apply the ``weights_init`` function to randomly initialize all weights</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#  to ``mean=0``, ``stdev=0.02``.</span>
</span></span><span style="display:flex;"><span>netG.apply(weights_init)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Print the model</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">print</span>(netG)
</span></span></code></pre></td></tr></table>
</div>
</div><img src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/image-20240828131924559.png" alt="image-20240828131924559" style="zoom:67%;" />
<h2 id="25-å®šä¹‰è¾¨åˆ«å™¨">2.5 å®šä¹‰è¾¨åˆ«å™¨<a hidden class="anchor" aria-hidden="true" href="#25-å®šä¹‰è¾¨åˆ«å™¨">#</a></h2>
<ul>
<li>è¾¨åˆ«å™¨Dï¼šä¸»è¦ä½¿ç”¨å·ç§¯å±‚ï¼Œè¾“å‡ºä¸ºä¸€ä¸ªæ ‡é‡</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Discriminator(nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __init__(<span style="color:#fff;font-weight:bold">self</span>, ngpu):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(Discriminator, <span style="color:#fff;font-weight:bold">self</span>).__init__()
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">self</span>.ngpu = ngpu
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">self</span>.main = nn.Sequential(
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># input is ``(nc) x 64 x 64``</span>
</span></span><span style="display:flex;"><span>            nn.Conv2d(nc, ndf, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.LeakyReLU(<span style="color:#ff0;font-weight:bold">0.2</span>, inplace=<span style="color:#fff;font-weight:bold">True</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># state size. ``(ndf) x 32 x 32``</span>
</span></span><span style="display:flex;"><span>            nn.Conv2d(ndf, ndf * <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.BatchNorm2d(ndf * <span style="color:#ff0;font-weight:bold">2</span>),
</span></span><span style="display:flex;"><span>            nn.LeakyReLU(<span style="color:#ff0;font-weight:bold">0.2</span>, inplace=<span style="color:#fff;font-weight:bold">True</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># state size. ``(ndf*2) x 16 x 16``</span>
</span></span><span style="display:flex;"><span>            nn.Conv2d(ndf * <span style="color:#ff0;font-weight:bold">2</span>, ndf * <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.BatchNorm2d(ndf * <span style="color:#ff0;font-weight:bold">4</span>),
</span></span><span style="display:flex;"><span>            nn.LeakyReLU(<span style="color:#ff0;font-weight:bold">0.2</span>, inplace=<span style="color:#fff;font-weight:bold">True</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># state size. ``(ndf*4) x 8 x 8``</span>
</span></span><span style="display:flex;"><span>            nn.Conv2d(ndf * <span style="color:#ff0;font-weight:bold">4</span>, ndf * <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.BatchNorm2d(ndf * <span style="color:#ff0;font-weight:bold">8</span>),
</span></span><span style="display:flex;"><span>            nn.LeakyReLU(<span style="color:#ff0;font-weight:bold">0.2</span>, inplace=<span style="color:#fff;font-weight:bold">True</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># state size. ``(ndf*8) x 4 x 4``</span>
</span></span><span style="display:flex;"><span>            nn.Conv2d(ndf * <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">0</span>, bias=<span style="color:#fff;font-weight:bold">False</span>),
</span></span><span style="display:flex;"><span>            nn.Sigmoid()
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> forward(<span style="color:#fff;font-weight:bold">self</span>, <span style="color:#fff;font-weight:bold">input</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">self</span>.main(<span style="color:#fff;font-weight:bold">input</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ¨¡å‹åˆå§‹åŒ–</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f"># Create the Discriminator</span>
</span></span><span style="display:flex;"><span>netD = Discriminator(ngpu).to(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Handle multi-GPU if desired</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (device.type == <span style="color:#0ff;font-weight:bold">&#39;cuda&#39;</span>) and (ngpu &gt; <span style="color:#ff0;font-weight:bold">1</span>):
</span></span><span style="display:flex;"><span>    netD = nn.DataParallel(netD, <span style="color:#fff;font-weight:bold">list</span>(<span style="color:#fff;font-weight:bold">range</span>(ngpu)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Apply the ``weights_init`` function to randomly initialize all weights</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># like this: ``to mean=0, stdev=0.2``.</span>
</span></span><span style="display:flex;"><span>netD.apply(weights_init)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Print the model</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">print</span>(netD)
</span></span></code></pre></td></tr></table>
</div>
</div><img src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/image-20240828132233649.png" alt="image-20240828132233649" style="zoom:67%;" />
<h2 id="26-è®­ç»ƒæ¨¡å‹">2.6 è®­ç»ƒæ¨¡å‹<a hidden class="anchor" aria-hidden="true" href="#26-è®­ç»ƒæ¨¡å‹">#</a></h2>
<ul>
<li>å®šä¹‰æŸå¤±å‡½æ•°ã€ä¼˜åŒ–å™¨ç­‰</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f"># Initialize the ``BCELoss`` function äºŒåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°</span>
</span></span><span style="display:flex;"><span>criterion = nn.BCELoss()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Create batch of latent vectors that we will use to visualize the progression of the generator</span>
</span></span><span style="display:flex;"><span>fixed_noise = torch.randn(<span style="color:#ff0;font-weight:bold">64</span>, nz, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">1</span>, device=device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Establish convention for real and fake labels during training</span>
</span></span><span style="display:flex;"><span>real_label = <span style="color:#ff0;font-weight:bold">1.</span>
</span></span><span style="display:flex;"><span>fake_label = <span style="color:#ff0;font-weight:bold">0.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Setup Adam optimizers for both G and D ä¼˜åŒ–ç®—æ³•</span>
</span></span><span style="display:flex;"><span>optimizerD = optim.Adam(netD.parameters(), lr=lr, betas=(beta1, <span style="color:#ff0;font-weight:bold">0.999</span>))
</span></span><span style="display:flex;"><span>optimizerG = optim.Adam(netG.parameters(), lr=lr, betas=(beta1, <span style="color:#ff0;font-weight:bold">0.999</span>))
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è®­ç»ƒä»£ç </li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f"># Lists to keep track of progress</span>
</span></span><span style="display:flex;"><span>img_list = []
</span></span><span style="display:flex;"><span>G_losses = []
</span></span><span style="display:flex;"><span>D_losses = []
</span></span><span style="display:flex;"><span>iters = <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#34;Starting Training Loop...&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># For each epoch</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> epoch in <span style="color:#fff;font-weight:bold">range</span>(num_epochs):
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># For each batch in the dataloader</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> i, data in <span style="color:#fff;font-weight:bold">enumerate</span>(dataloader, <span style="color:#ff0;font-weight:bold">0</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">############################</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># (1) Update D network: maximize log(D(x)) + log(1 - D(G(z)))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">###########################</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">## Train with all-real batchï¼Œé‡ç½®æ¨¡å‹Dçš„æ¢¯åº¦</span>
</span></span><span style="display:flex;"><span>        netD.zero_grad()
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Format batch</span>
</span></span><span style="display:flex;"><span>        real_cpu = data[<span style="color:#ff0;font-weight:bold">0</span>].to(device)
</span></span><span style="display:flex;"><span>        b_size = real_cpu.size(<span style="color:#ff0;font-weight:bold">0</span>)
</span></span><span style="display:flex;"><span>        label = torch.full((b_size,), real_label, dtype=torch.float, device=device)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Forward pass real batch through D, è½¬ä¸ºä¸€ç»´å‘é‡</span>
</span></span><span style="display:flex;"><span>        output = netD(real_cpu).view(-<span style="color:#ff0;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Calculate loss on all-real batch</span>
</span></span><span style="display:flex;"><span>        errD_real = criterion(output, label)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Calculate gradients for D in backward passï¼ŒåŸºäºçœŸå®æ ·æœ¬çš„æ¢¯åº¦æ›´æ–°</span>
</span></span><span style="display:flex;"><span>        errD_real.backward()
</span></span><span style="display:flex;"><span>        D_x = output.mean().item()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">## Train with all-fake batch</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Generate batch of latent vectorsï¼ŒåŸºäºæ­£æ€åˆ†å¸ƒï¼Œéšæœºåˆå§‹åŒ–è¾“å…¥z</span>
</span></span><span style="display:flex;"><span>        noise = torch.randn(b_size, nz, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">1</span>, device=device)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Generate fake image batch with G</span>
</span></span><span style="display:flex;"><span>        fake = netG(noise)
</span></span><span style="display:flex;"><span>        label.fill_(fake_label)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Classify all fake batch with D</span>
</span></span><span style="display:flex;"><span>        output = netD(fake.detach()).view(-<span style="color:#ff0;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Calculate D&#39;s loss on the all-fake batch</span>
</span></span><span style="display:flex;"><span>        errD_fake = criterion(output, label)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Calculate the gradients for this batch, accumulated (summed) with previous gradients</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># å†åŸºäºæ¨¡æ‹Ÿæ ·æœ¬çš„æ¢¯åº¦æ›´æ–°ï¼Œä¸¤æ¬¡æ¢¯åº¦çš„ç»“æœä¼šç´¯åŠ </span>
</span></span><span style="display:flex;"><span>        errD_fake.backward()
</span></span><span style="display:flex;"><span>        D_G_z1 = output.mean().item()
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Compute error of D as sum over the fake and the real batches</span>
</span></span><span style="display:flex;"><span>        errD = errD_real + errD_fake
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Update Dï¼ŒåŸºäºä¸Šé¢ä¸¤è½®çš„æ¢¯åº¦ï¼Œæ›´æ–°æ¨¡å‹å‚æ•°</span>
</span></span><span style="display:flex;"><span>        optimizerD.step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">############################</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># (2) Update G network: maximize log(D(G(z)))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">###########################</span>
</span></span><span style="display:flex;"><span>        netG.zero_grad() <span style="color:#007f7f">#é‡ç½®æ¨¡å‹Gçš„æ¢¯åº¦</span>
</span></span><span style="display:flex;"><span>        label.fill_(real_label)  <span style="color:#007f7f"># fake labels are real for generator cost</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Since we just updated D, perform another forward pass of all-fake batch through D</span>
</span></span><span style="display:flex;"><span>        output = netD(fake).view(-<span style="color:#ff0;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Calculate G&#39;s loss based on this output</span>
</span></span><span style="display:flex;"><span>        errG = criterion(output, label)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Calculate gradients for G</span>
</span></span><span style="display:flex;"><span>        errG.backward()
</span></span><span style="display:flex;"><span>        D_G_z2 = output.mean().item()
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Update G</span>
</span></span><span style="display:flex;"><span>        optimizerG.step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Output training statsï¼Œæ¯50ä¸ªbatchæ‰“å°ä¸€æ¬¡ç»“æœ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> i % <span style="color:#ff0;font-weight:bold">50</span> == <span style="color:#ff0;font-weight:bold">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#39;[</span><span style="color:#0ff;font-weight:bold">%d</span><span style="color:#0ff;font-weight:bold">/</span><span style="color:#0ff;font-weight:bold">%d</span><span style="color:#0ff;font-weight:bold">][</span><span style="color:#0ff;font-weight:bold">%d</span><span style="color:#0ff;font-weight:bold">/</span><span style="color:#0ff;font-weight:bold">%d</span><span style="color:#0ff;font-weight:bold">]</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">Loss_D: </span><span style="color:#0ff;font-weight:bold">%.4f</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">Loss_G: </span><span style="color:#0ff;font-weight:bold">%.4f</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">D(x): </span><span style="color:#0ff;font-weight:bold">%.4f</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">D(G(z)): </span><span style="color:#0ff;font-weight:bold">%.4f</span><span style="color:#0ff;font-weight:bold"> / </span><span style="color:#0ff;font-weight:bold">%.4f</span><span style="color:#0ff;font-weight:bold">&#39;</span>
</span></span><span style="display:flex;"><span>                  % (epoch, num_epochs, i, <span style="color:#fff;font-weight:bold">len</span>(dataloader),
</span></span><span style="display:flex;"><span>                     errD.item(), errG.item(), D_x, D_G_z1, D_G_z2))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Save Losses for plotting later</span>
</span></span><span style="display:flex;"><span>        G_losses.append(errG.item())
</span></span><span style="display:flex;"><span>        D_losses.append(errD.item())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># è®°å½•ä¸åŒè®­ç»ƒé˜¶æ®µçš„è®­ç»ƒç”Ÿæˆç»“æœ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># Check how the generator is doing by saving G&#39;s output on fixed_noise</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (iters % <span style="color:#ff0;font-weight:bold">500</span> == <span style="color:#ff0;font-weight:bold">0</span>) or ((epoch == num_epochs-<span style="color:#ff0;font-weight:bold">1</span>) and (i == <span style="color:#fff;font-weight:bold">len</span>(dataloader)-<span style="color:#ff0;font-weight:bold">1</span>)):
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">with</span> torch.no_grad():
</span></span><span style="display:flex;"><span>                fake = netG(fixed_noise).detach().cpu()
</span></span><span style="display:flex;"><span>            img_list.append(vutils.make_grid(fake, padding=<span style="color:#ff0;font-weight:bold">2</span>, normalize=<span style="color:#fff;font-weight:bold">True</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        iters += <span style="color:#ff0;font-weight:bold">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/image-20240828134313739.png" alt="image-20240828134313739" style="zoom:67%;" />
<ul>
<li>æŸ¥çœ‹è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹Gä¸Dçš„æŸå¤±å‡½æ•°</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>plt.figure(figsize=(<span style="color:#ff0;font-weight:bold">10</span>,<span style="color:#ff0;font-weight:bold">5</span>))
</span></span><span style="display:flex;"><span>plt.title(<span style="color:#0ff;font-weight:bold">&#34;Generator and Discriminator Loss During Training&#34;</span>)
</span></span><span style="display:flex;"><span>plt.plot(G_losses,label=<span style="color:#0ff;font-weight:bold">&#34;G&#34;</span>)
</span></span><span style="display:flex;"><span>plt.plot(D_losses,label=<span style="color:#0ff;font-weight:bold">&#34;D&#34;</span>)
</span></span><span style="display:flex;"><span>plt.xlabel(<span style="color:#0ff;font-weight:bold">&#34;iterations&#34;</span>)
</span></span><span style="display:flex;"><span>plt.ylabel(<span style="color:#0ff;font-weight:bold">&#34;Loss&#34;</span>)
</span></span><span style="display:flex;"><span>plt.legend()
</span></span><span style="display:flex;"><span>plt.show()
</span></span></code></pre></td></tr></table>
</div>
</div><img src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/sphx_glr_dcgan_faces_tutorial_002.png" alt="Generator and Discriminator Loss During Training" style="zoom:50%;" />
<ul>
<li>å¯¹æ¯”çœŸå®ä¸é¢„æµ‹å›¾ç‰‡æ ·æœ¬</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f"># Grab a batch of real images from the dataloader</span>
</span></span><span style="display:flex;"><span>real_batch = <span style="color:#fff;font-weight:bold">next</span>(<span style="color:#fff;font-weight:bold">iter</span>(dataloader))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Plot the real images</span>
</span></span><span style="display:flex;"><span>plt.figure(figsize=(<span style="color:#ff0;font-weight:bold">15</span>,<span style="color:#ff0;font-weight:bold">15</span>))
</span></span><span style="display:flex;"><span>plt.subplot(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>plt.axis(<span style="color:#0ff;font-weight:bold">&#34;off&#34;</span>)
</span></span><span style="display:flex;"><span>plt.title(<span style="color:#0ff;font-weight:bold">&#34;Real Images&#34;</span>)
</span></span><span style="display:flex;"><span>plt.imshow(np.transpose(vutils.make_grid(real_batch[<span style="color:#ff0;font-weight:bold">0</span>].to(device)[:<span style="color:#ff0;font-weight:bold">64</span>], padding=<span style="color:#ff0;font-weight:bold">5</span>, normalize=<span style="color:#fff;font-weight:bold">True</span>).cpu(),(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">0</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Plot the fake images from the last epoch</span>
</span></span><span style="display:flex;"><span>plt.subplot(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>)
</span></span><span style="display:flex;"><span>plt.axis(<span style="color:#0ff;font-weight:bold">&#34;off&#34;</span>)
</span></span><span style="display:flex;"><span>plt.title(<span style="color:#0ff;font-weight:bold">&#34;Fake Images&#34;</span>)
</span></span><span style="display:flex;"><span>plt.imshow(np.transpose(img_list[-<span style="color:#ff0;font-weight:bold">1</span>],(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">0</span>)))
</span></span><span style="display:flex;"><span>plt.show()
</span></span></code></pre></td></tr></table>
</div>
</div><img src="https://raw.githubusercontent.com/lishensuo/images2/main/img01/image-20240828135040038.png" alt="image-20240828135040038" style="zoom:80%;" />

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://lishensuo.github.io/en/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">æ·±åº¦å­¦ä¹ </a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://lishensuo.github.io/en/posts/bioinfo/715d2l-%E7%AC%AC%E5%8D%81%E4%B8%80%E5%8F%8A%E5%8D%81%E4%BA%8C%E7%AB%A0%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95%E5%A4%9Agpu%E5%B9%B6%E8%A1%8C/">
    <span class="title">Â« Prev Page</span>
    <br>
    <span>D2L--ç¬¬åä¸€åŠåäºŒç« ä¼˜åŒ–ç®—æ³•&amp;å¤šGPUå¹¶è¡Œ</span>
  </a>
  <a class="next" href="https://lishensuo.github.io/en/posts/bioinfo/717hugging-face1-nlp-basic/">
    <span class="title">Next Page Â»</span>
    <br>
    <span>Hugging Face(1)-NLP basic</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="https://lishensuo.github.io/en/">Li&#39;s Bioinfo-Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
		<br/>æ‚¨æ˜¯æœ¬ç«™ç¬¬ <span id="busuanzi_value_site_uv"></span> ä½è®¿é—®è€…ï¼Œæ€»æµè§ˆé‡ä¸º <span id="busuanzi_value_site_pv"></span> æ¬¡
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<script type="text/javascript"
async
src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
tex2jax: {
inlineMath: [['$','$'], ['\\(','\\)']],
displayMath: [['$$','$$'], ['\[\[','\]\]']],
processEscapes: true,
processEnvironments: true,
skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
TeX: { equationNumbers: { autoNumber: "AMS" },
extensions: ["AMSmath.js", "AMSsymbols.js"] }
}
});

MathJax.Hub.Queue(function() {



var all = MathJax.Hub.getAllJax(), i;
for(i = 0; i < all.length; i += 1) {
all[i].SourceElement().parentNode.className += ' has-jax';
}
});
</script>

<style>
code.has-jax {
font: inherit;
font-size: 100%;
background: inherit;
border: inherit;
color: #515151;
}
</style></body>
</html>
